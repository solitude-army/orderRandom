# éšæœºç‚¹èœç³»ç»ŸæŠ€æœ¯æ¶æ„æ–‡æ¡£

## 1. Architecture design

```mermaid
graph TD
    A[User Browser] --> B[React Frontend Application]
    B --> C[Supabase SDK]
    C --> D[Supabase Service]
    B --> E[Local Storage]

    subgraph "Frontend Layer"
        B
        E
    end

    subgraph "Service Layer (Provided by Supabase)"
        D
    end
```

## 2. Technology Description

* Frontend: React\@18 + TypeScript\@5 + Vite\@5 + TailwindCSS\@3

* Backend: Supabase (PostgreSQL + Storage + Auth)

* State Management: Zustand\@4

* UI Components: Headless UI + Heroicons

* Image Processing: react-image-crop\@11

* Charts: Chart.js\@4 (for future analytics)

## 3. Route definitions

| Route      | Purpose            |
| ---------- | ------------------ |
| /          | é¦–é¡µï¼Œæ˜¾ç¤ºéšæœºæ¨èå’Œå¿«é€Ÿæ“ä½œå…¥å£   |
| /manage    | èœå“ç®¡ç†é¡µï¼Œæ·»åŠ è‡ªå®šä¹‰èœå“å’Œä¸Šä¼ å›¾ç‰‡ |
| /library   | èœå“åº“é¡µï¼Œæµè§ˆå’Œé€‰æ‹©é¢„è®¾èœå“     |
| /my-dishes | æˆ‘çš„èœå“åº“é¡µï¼Œç®¡ç†ä¸ªäººèœå“æ”¶è—    |
| /dish/:id  | èœå“è¯¦æƒ…é¡µï¼ŒæŸ¥çœ‹å•ä¸ªèœå“çš„è¯¦ç»†ä¿¡æ¯  |

## 4. API definitions

### 4.1 Core API

èœå“ç®¡ç†ç›¸å…³

```
GET /api/dishes
```

Response:

| Param Name | Param Type | Description |
| ---------- | ---------- | ----------- |
| dishes     | Dish\[]    | èœå“åˆ—è¡¨æ•°ç»„      |
| total      | number     | èœå“æ€»æ•°        |

```
POST /api/dishes
```

Request:

| Param Name  | Param Type | isRequired | Description |
| ----------- | ---------- | ---------- | ----------- |
| name        | string     | true       | èœå“åç§°        |
| description | string     | false      | èœå“æè¿°        |
| category    | string     | true       | èœå“åˆ†ç±»        |
| image\_url  | string     | false      | èœå“å›¾ç‰‡URL     |
| is\_custom  | boolean    | true       | æ˜¯å¦ä¸ºç”¨æˆ·è‡ªå®šä¹‰èœå“  |

```
DELETE /api/dishes/:id
```

ç”¨æˆ·èœå“åº“ç®¡ç†

```
GET /api/user-dishes
```

```
POST /api/user-dishes
```

Request:

| Param Name | Param Type | isRequired | Description |
| ---------- | ---------- | ---------- | ----------- |
| dish\_id   | string     | true       | èœå“ID        |
| user\_id   | string     | true       | ç”¨æˆ·ID (æœ¬åœ°å­˜å‚¨) |

éšæœºæ¨è

```
GET /api/random-dish
```

Response:

| Param Name | Param Type | Description |
| ---------- | ---------- | ----------- |
| dish       | Dish       | éšæœºæ¨èçš„èœå“å¯¹è±¡   |

### 4.2 Type Definitions

```typescript
interface Dish {
  id: string;
  name: string;
  description?: string;
  category: string;
  image_url?: string;
  is_custom: boolean;
  created_at: string;
  updated_at: string;
}

interface UserDish {
  id: string;
  user_id: string;
  dish_id: string;
  added_at: string;
  dish?: Dish;
}

interface Category {
  id: string;
  name: string;
  icon: string;
}
```

## 5. Data model

### 5.1 Data model definition

```mermaid
erDiagram
    DISHES ||--o{ USER_DISHES : contains
    CATEGORIES ||--o{ DISHES : categorizes

    DISHES {
        uuid id PK
        varchar name
        text description
        varchar category
        varchar image_url
        boolean is_custom
        timestamp created_at
        timestamp updated_at
    }
    
    USER_DISHES {
        uuid id PK
        varchar user_id
        uuid dish_id FK
        timestamp added_at
    }
    
    CATEGORIES {
        varchar id PK
        varchar name
        varchar icon
    }
```

### 5.2 Data Definition Language

èœå“è¡¨ (dishes)

```sql
-- create table
CREATE TABLE dishes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    category VARCHAR(50) NOT NULL,
    image_url VARCHAR(500),
    is_custom BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- create index
CREATE INDEX idx_dishes_category ON dishes(category);
CREATE INDEX idx_dishes_is_custom ON dishes(is_custom);
CREATE INDEX idx_dishes_created_at ON dishes(created_at DESC);

-- RLS policies
GRANT SELECT ON dishes TO anon;
GRANT ALL PRIVILEGES ON dishes TO authenticated;
```

ç”¨æˆ·èœå“åº“è¡¨ (user\_dishes)

```sql
-- create table
CREATE TABLE user_dishes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR(100) NOT NULL,
    dish_id UUID NOT NULL REFERENCES dishes(id) ON DELETE CASCADE,
    added_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- create index
CREATE INDEX idx_user_dishes_user_id ON user_dishes(user_id);
CREATE INDEX idx_user_dishes_dish_id ON user_dishes(dish_id);
CREATE UNIQUE INDEX idx_user_dishes_unique ON user_dishes(user_id, dish_id);

-- RLS policies
GRANT SELECT ON user_dishes TO anon;
GRANT ALL PRIVILEGES ON user_dishes TO authenticated;
```

åˆ†ç±»è¡¨ (categories)

```sql
-- create table
CREATE TABLE categories (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    icon VARCHAR(50) NOT NULL
);

-- init data
INSERT INTO categories (id, name, icon) VALUES
('chinese', 'ä¸­å¼èœå“', 'ğŸ¥¢'),
('western', 'è¥¿å¼èœå“', 'ğŸ½ï¸'),
('japanese', 'æ—¥å¼èœå“', 'ğŸ±'),
('korean', 'éŸ©å¼èœå“', 'ğŸ²'),
('dessert', 'ç”œå“é¥®å“', 'ğŸ°'),
('snack', 'å°é£Ÿé›¶é£Ÿ', 'ğŸ¿'),
('hotpot', 'ç«é”…çƒ§çƒ¤', 'ğŸ²'),
('noodles', 'é¢é£Ÿç²‰é¢', 'ğŸœ');

-- RLS policies
GRANT SELECT ON categories TO anon;
GRANT ALL PRIVILEGES ON categories TO authenticated;
```

é¢„è®¾èœå“æ•°æ®

```sql
-- init dishes data
INSERT INTO dishes (name, description, category, image_url, is_custom) VALUES
('å®«ä¿é¸¡ä¸', 'ç»å…¸å·èœï¼Œé¸¡è‚‰å«©æ»‘ï¼ŒèŠ±ç”Ÿé¦™è„†', 'chinese', null, false),
('éº»å©†è±†è…', 'éº»è¾£é²œé¦™çš„ç»å…¸å·èœ', 'chinese', null, false),
('ç³–é†‹é‡Œè„Š', 'é…¸ç”œå¯å£çš„å®¶å¸¸èœ', 'chinese', null, false),
('æ„å¤§åˆ©é¢', 'ç»å…¸ç•ªèŒ„è‚‰é…±æ„é¢', 'western', null, false),
('ç‰›æ’', 'ç…åˆ¶å®Œç¾çš„è¥¿å¼ç‰›æ’', 'western', null, false),
('å¯¿å¸æ‹¼ç›˜', 'æ–°é²œçš„æ—¥å¼å¯¿å¸ç»„åˆ', 'japanese', null, false),
('æ‹‰é¢', 'æµ“éƒæ±¤å¤´çš„æ—¥å¼æ‹‰é¢', 'japanese', null, false),
('éŸ©å¼ç‚¸é¸¡', 'é¦™è„†å¯å£çš„éŸ©å¼ç‚¸é¸¡', 'korean', null, false),
('çŸ³é”…æ‹Œé¥­', 'è¥å…»ä¸°å¯Œçš„éŸ©å¼æ‹Œé¥­', 'korean', null, false),
('ææ‹‰ç±³è‹', 'æ„å¼ç»å…¸ç”œå“', 'dessert', null, false),
('èŠå£«è›‹ç³•', 'æµ“éƒé¦™ç”œçš„èŠå£«è›‹ç³•', 'dessert', null, false),
('è–¯æ¡', 'é‡‘é»„é…¥è„†çš„ç‚¸è–¯æ¡', 'snack', null, false),
('çˆ†ç±³èŠ±', 'é¦™ç”œçš„çˆ†ç±³èŠ±', 'snack', null, false),
('éº»è¾£ç«é”…', 'å››å·é£å‘³éº»è¾£ç«é”…', 'hotpot', null, false),
('çƒ¤è‚‰', 'éŸ©å¼çƒ¤è‚‰', 'hotpot', null, false),
('å…°å·æ‹‰é¢', 'æ¸…æ±¤ç‰›è‚‰é¢', 'noodles', null, false),
('æ„å¤§åˆ©é¢æ¡', 'å¥¶æ²¹è˜‘è‡æ„é¢', 'noodles', null, false);
```

